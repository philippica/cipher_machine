<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>ç„–è‚‰é¢ - puzzle huntå·¥å…·é›†</title>
		<style>
			.capsule{
				background-color: #9eddff;
				width: 100%;
				height: 20px;
				border-radius: 10px;
				text-align: center;
				margin:2px;
				cursor: pointer;
				margin: 5px;
			}
			.flag-shape {
                margin: 10px;
                width: 0;
                height: 0;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-bottom: 30px solid #000000;
			}
			.transparent {
				opacity: .1;
			}
			.capsule:hover{
				font-weight: bold;
				-webkit-transform: translateX(-3px);
				transform: translateX(-3px);
				transition: .5s ease;
			}
			.content-area {
				height: fit-content;
			}
			.container {
				width: 50%;
			}
			.content-area textarea {
				background-color: #f8f8f8;
  				font-size: 16px;
				margin: 10px;
			}
			.help-content {
				font-size: 12px;
    			color: #adabab;
				background-color: "unset";
			}
			#word-search-content, #word-search-mat {
				width: 400px;
				height: 400px;
				margin-left: 20px;
			}
			#word-search-mat {
				display: flex;
			}
			.word-content {
				width: 80%;
				display: flex;
				flex-wrap: wrap;
				word-break: break-word;
			}
			#word-find-similarity-hint {
				margin-top: 30px;
			}
			.word-content > div{
				margin: 5px
			}
			.word-content > b{
				flex-basis: 100%;
				font-size: 20px;
			}
			#footer, h1, h3 {
				margin: 40px;
				display: flex;
				justify-content: space-around;
			}
			.face-container {
				width: fit-content;
				display: flex;
				width: 100%;
				justify-content: space-around;
			}
			#expand {
				width: fit-content;
				margin: 10px;
			}
			.face {
				height: 200px;
				width: 200px;

			}
			.cube-block {
				background-color: gray;
				vertical-align: bottom;
				border: 1px solid;
			}
			#rubik-cube{
				border: 5px solid;
			}
			.piano {
				height: 250px;
				width: 100%;
			}
			.piano li {
				padding:0;
				list-style:none;
				position:relative;
				float:left
			}


			.piano .white {
				height:16em;
				width:3.1em;
				z-index:1;
				border-left:1px solid #bbb;
				border-bottom:1px solid #bbb;
				border-radius:0 0 5px 5px;
				box-shadow:-1px 0 0 rgba(255,255,255,0.8) inset,0 0 5px #ccc inset,0 0 3px rgba(0,0,0,0.2);
				background:linear-gradient(to bottom,#eee 0%,#fff 100%)
			}

			.piano .white:active {
				border-top:1px solid #777;
				border-left:1px solid #999;
				border-bottom:1px solid #999;
				box-shadow:2px 0 3px rgba(0,0,0,0.1) inset,-5px 5px 20px rgba(0,0,0,0.2) inset,0 0 3px rgba(0,0,0,0.2);
				background:linear-gradient(to bottom,#fff 0%,#e9e9e9 100%)
			}

			.piano .black {
				height:8em;
				width:2em;
				margin:0 0 0 -1em;
				z-index:2;
				border:1px solid #000;
				border-radius:0 0 3px 3px;
				box-shadow:-1px -1px 2px rgba(255,255,255,0.2) inset,0 -5px 2px 3px rgba(0,0,0,0.6) inset,0 2px 4px rgba(0,0,0,0.5);
				background:linear-gradient(45deg,#222 0%,#555 100%)
			}

			.piano .black:active {
				box-shadow:-1px -1px 2px rgba(255,255,255,0.2) inset,0 -2px 2px 3px rgba(0,0,0,0.6) inset,0 1px 2px rgba(0,0,0,0.5);
				background:linear-gradient(to right,#444 0%,#222 100%)
			}

			.piano .sp {
				margin:0 0 0 -1em
			}

			.ws-answer {
				cursor: pointer;
			}

			.ws-answer:hover {
				border: 1px solid;
			}

			.blind-dot {
				border-radius: 50%;
				width: 30px;
				height: 30px;
				border: 1px solid;
				margin: 10px 2px 2px 10px;
			}
			#blind-letter, #flag-letter{
				font-size: 20px;
				margin-left: 40px;
				margin-top: 20px;
			}
			.map-unit {
				width: 25px;
			}
			.map-unit input{
				width: 22px;
				background-color: #80808036;
			}
			.map-unit div {
				margin-left: 4px;
			}
			.sudoku-grid {
				width: 30px;
				height: 30px;
				border: 2px solid;
				margin-right: -1px;
				margin-bottom: -1px;
			}
			#sudokuContainer, #word-search-mat{
				display: flex;
				flex-wrap: wrap;
				align-content: flex-start;
			}
			.sudoku-grid-content {
				height: 26px;
				width: 26px;
				margin: 1px;
				text-align: center;
			}
			.sudoku-index {
				z-index: -1;
				font-size: 12;
				opacity: 0.2;
				position: absolute;
			}

			#view, #files {
				margin: 30px;
			}
			
			.line {
				width: 0px;
				border: 1px solid;
				height: 100%;
				background-color: black;
				position: absolute;
				cursor: pointer
			}
			#wave{
				position: absolute;
				width: 100%;
				height: 100%;
				z-index:-2;
			}
			#waveContainer {
				height: 200px;
				width: 1000px;
			}
			#frequency {
				height: 500px;
				width: 16380px;
				vertical-align: bottom;
				display: flex;
				flex-wrap: wrap;
				justify-content: flex-start;
				align-content: stretch;
				align-items: flex-end;
			}
			#selectedArea {
				height: 100%;
				position: absolute;
				background-color: gray;
				width: inherit;
				margin-left: 2px;
				z-index:-1;
        		opacity: 0.3;
			}
			.bar {
				width: 0px;
				border-left: 1px solid;
				transition: height .5s;
			}
			.noteTooltip {
				position: relative;
				display: inline-block;
				cursor: pointer;
			}
			.tooltiptext {
				visibility: hidden;
				width: 120px;
				background-color: black;
				color: #fff;
				text-align: center;
				padding: 5px 0;
				border-radius: 6px;
				position: absolute;
				z-index: 1;
			}

			.noteTooltip:hover .tooltiptext {
				visibility: visible;
			}
			.form-control {
				font-family: monospace, monospace;
			}
			#plain-code-area {
				font-size: x-large;
				margin: 40px;
			}
			#sudoku-upper .col-input {
				width: 30px;
			}
			#sudoku-upper {
				margin-bottom: 10px;
				margin-right: 0px !important;
			}
			#sudoku-left .row-input {
				height: 30px;
				margin-left: -1px !important;

			}
			#sudoku-left {
				margin-right: 10px !important;
			}
			#smart-analysis-ansers {
				min-height: 100px;
				border: 1px solid;
			}
			.analysis-hint {
				color: grey;
    			font-size: smaller;
			}
			.analysis-bar {
				margin-left: 30px;
			}
			.sudoku-grid-content {
			position: relative;
			}

			.sudoku-grid-content:before, .sudoku-grid-content:after {
			content: "";
			position: absolute;
			z-index: 10;
			background: black;
			}

			.UL:before, .UR:before{
			left: 50%;
			width: 10%;
			margin-left: -5%;
			height: 55%;
			}

			.UL:after, .BL:after {
			top: 50%;
			left: 0%;
			height: 10%;
			margin-top: -5%;
			width: 55%;
			}

			.RL:after {
				top: 50%;
				left: 0%;
				height: 10%;
				margin-top: -5%;
				width: 100%;
			}

			.UB:before {
				left: 50%;
				width: 10%;
				margin-left: -5%;
				top: 0%;
				height: 100%;
			}

			.RB:before, .BL:before {
			left: 50%;
			width: 10%;
			margin-left: -5%;
			top: 50%;
			height: 55%;
			}

			.RB:after, .UR:after {
			top: 50%;
			left: 45%;
			height: 10%;
			margin-top: -5%;
			width: 55%;
			}
			.horizon- {
				width: 100%;
				height: 1px;
				background-color: black;
				position: absolute;
				z-index: 10;
				border: 1px solid;
			}
			.vertical- {
				width: 1px;
				height: 100%;
				background-color: black;
				position: absolute;
				z-index: 10;
				border: 1px solid;
			}

			#cvs-tools span:hover {
				border: 1px solid black;
				cursor: pointer;
			}


			#cvs-tools {
				border: 1px solid black;
				width: 45px;
			}

			#cvs {
				border: 1px solid black;
			}

 		</style>
		<link rel="stylesheet" href="./static/nonogram.css">
		<link rel="stylesheet" href="./static/bootstrap.min.css">
	</head>
	<body>
		<h1>ç„–è‚‰é¢- puzzle huntå·¥å…·é›†</h1>
		<h3>æ­£åœ¨åŠ è½½æ‰€éœ€è¦çš„èµ„æºï¼Œæš‚æ—¶åŠŸèƒ½ä¸å¯ç”¨,è¯·ç¨ç­‰ç‰‡åˆ»ï¼Œå¦‚æœå®åœ¨å¤ªæ…¢ï¼Œå¯ä¸‹è½½æœ¬é¡µé¢åˆ°ç”µè„‘æœ¬åœ°ä½¿ç”¨</h3>
		<div style="text-align: center;">
			å¸¸ç”¨é“¾æ¥:
			<a href="https://philippica.github.io/ChinesePuzzleTool/">ç„–è‚‰é¢ä¸­æ–‡ç‰ˆ</a>
			<a href="https://philippica.github.io/cipher_machine/cipher_sheet">å¸¸ç”¨å¯†ç è¡¨</a>
			<a href="https://www.quinapalus.com/cgi-bin/qat">QAT(éå¸¸å¼ºå¤§çš„æŸ¥è¯å·¥å…·)</a>
			<a href="https://nutrimatic.org/">NUTRI(è¯ç»„æš´åŠ›å·¥å…·)</a>
			<a href="https://www.quipqiup.com/">QUIPQIUP(è‡ªåŠ¨å•è¡¨æš´åŠ›å·¥å…·)</a>
			<a href="https://www.wordplays.com/crossword-solver">Crosswordçº¿ç´¢æŸ¥è¯¢ç½‘ç«™</a>
			<a href="https://nova.astrometry.net/">é€šè¿‡æ˜Ÿç©ºç…§ç‰‡å°±èƒ½æ‰¾åˆ°æ˜Ÿåº§ä»¥åŠæ‹æ‘„ä½ç½®çš„ç½‘ç«™</a>
		</div>
		<div class="container">
			<div id="word-container">
				<div id="word-capsule" class="capsule" data-expend=true>puzzle å­—å…¸(æ­£åˆ™åŒ¹é…ã€anagramã€é€šé…ç¬¦ã€ç¼–è¾‘è·ç¦»)</div>
				<div id="word-main" class="content-area">
					<fieldset>
						<legend>é€‰æ‹©éœ€è¦ç­›é€‰çš„ç±»åˆ«</legend>
						<div>
							<input type="checkbox" id="all" name="all" checked>
							<label for="all">å…¨é€‰</label>
						</div>
						<div>
						  <input type="checkbox" id="noun" name="noun" checked>
						  <label for="noun">åè¯</label>
						</div>
						<div>
							<input type="checkbox" id="verb" name="verb" checked>
							<label for="verb">åŠ¨è¯</label>
						</div>
						<div>
							<input type="checkbox" id="adj" name="adj" checked>
							<label for="adj">å½¢å®¹è¯</label>
						</div>
						<div>
							<input type="checkbox" id="adv" name="adv" checked>
							<label for="adv">å‰¯è¯</label>
						</div>
						<div>
							<input type="checkbox" id="lowfrequcy" name="lowfrequcy" checked>
							<label for="lowfrequcy">ä½é¢‘è¯</label>
						</div>
					</fieldset>
					<textarea id="one-word-content" class="form-control" placeholder="è¯·è¾“å…¥è¦æŸ¥è¯¢çš„å•è¯"></textarea>
					<div id="method-select">
						<select onchange="changeMethod()" id="find-method">
							<option value ="findByWildcard">é€šé…ç¬¦</option>
							<option value ="findByRegularExpression">æ­£åˆ™</option>
							<option value ="contains">åŒ…å«</option>
							<option value ="findSimilarity">å¯»æ‰¾ç›¸ä¼¼å•è¯(ç¼–è¾‘è·ç¦»)</option>
							<option value ="findByCode">DIYå†™ç¨‹åºæŸ¥æ‰¾</option>
						</select>
						<div id="twoWordContainer"><span>ä¸¤ä¸ªè¯</span><input type="checkbox" id="twoWords" /></div>
					</div>
					<pre id="help-content" class="help-content"></pre>
					<button id="find-words">solve</button>
					<div>ä»¥ä¸‹ä¸ºå¯èƒ½ç»“æœ:</div>
					<div id="word-list-count"></div>
					<div id="words-list"></div>
				</div>
			</div>
			<div id="substitution-container">
				<div id="substitution-capsule" class="capsule" data-expend=true>å•è¡¨æ›¿æ¢</div>
				<div id="substitution-main" class="content-area" style="display: none;">
					<form role="form">
						<div class="form-group">
							<div>å•è¡¨æš´åŠ›</div>
							<textarea id="content" class="form-control" rows="20" placeholder="è¯·è¾“å…¥å•è¡¨å¯†æ–‡"></textarea>
							<div>
								<button id="substitution-solver-btn" type="button">å•è¡¨æš´åŠ›</button>
							</div>
						</div>
					</form>
					<div>ä»¥ä¸‹ä¸ºå¯èƒ½ç»“æœ:</div>
					<div id="substitution-answer"></div>
				</div>
			</div>
			<div id="word-search-container">
				<div id="word-search-capsule" class="capsule" data-expend=true>Word Search</div>
				<div id="word-search-main" class="content-area" style="display: none;">
					<div class="help-content">Word Searchæ˜¯ä¸€ä¸ªæ‰¾è¯æ¸¸æˆï¼Œç»™å‡ºä¸€ä¸ªn*mçš„å­—æ¯æ–¹é˜µï¼Œè¦æ±‚åœ¨æ¨ªç«–æ–œçš„æ–¹å‘ä¸Šæ‰¾åˆ°è‹±è¯­å•è¯</div>
					<div class="help-content">åœ¨ä¸‹é¢æ–‡æœ¬æ¡†å†…å¡«å…¥è¦word searchçš„å­—æ¯æ–¹é˜µï¼Œä¾‹å¦‚</div>
					<div class="help-content">abc</div>
					<div class="help-content">ddf</div>
					<div class="help-content">ghi</div>
					<span>åªæœæ¨ª/ç«–/æ–œæ–¹å‘çš„å•è¯</span><input type="checkbox" id="onlyvh" checked> 
					<div style="display: flex">
						<div>
							<textarea id="word-search-content" class="form-control" placeholder="è¯·è¾“å‡ºå­—æ¯æ–¹é˜µ,ç”¨ç©ºè¡Œéš”å¼€"></textarea>
							<button onclick="wordSearch()">Solver</button>
						</div>
						<div id="word-search-mat">
						</div>
					</div>
					<div id="word-search-ansers" style="display: flex">
						<div id="word-search-ansers-list"></div>
						<div id="word-search-ansers-position" style="margin-left: 40px"></div>
					</div>
				</div>
			</div>
			<div id="smart-analysis-container">
				<div id="smart-analysis-capsule" class="capsule" data-expend="true">å¯†æ–‡æ™ºèƒ½åˆ†æ</div>
				<div id="rubik-cube-main" class="content-area" style="display:none">
					<div class="help-content">è¯·åœ¨ä¸‹é¢æ–‡æœ¬æ¡†å†…è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬, é€—å·æˆ–è€…ç©ºæ ¼å¯ä»¥ä½œä¸ºåˆ†éš”ç¬¦</div>
					<div>
						<textarea id="smart-analysis-content" class="form-control" rows="1" placeholder="è¯·è¾“å‡ºè¦åˆ†æçš„æ–‡æœ¬"></textarea>
					</div>
					<div id="smart-analysis-ansers" style="display:flex; font: 15px monospace;">
						<div id="smart-analysis-ansers-list"></div>
						<div id="smart-analysis-ansers-position" style="margin-left:40px"></div>
					</div>
				</div>
			</div>
			<div id="rubik-cube-container">
				<div id="rubik-cube-capsule" class="capsule" data-expend=true>é­”æ–¹</div>
				<div id="rubik-cube-main" class="content-area" style="display: none;">
					<div class="help-content">è¯·æ‹–åŠ¨é­”æ–¹è§‚çœ‹æ‰€æœ‰é¢:</div>
					<canvas id="rubik-cube" height="300px" width="300px"></canvas>
					<button onclick="resetRubicCube()">é‡ç½®é­”æ–¹</button>
					<div>
						<div>é¡ºæ—¶é’ˆ</div>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' F');window.rubicCube.front(1)">å‰é¢(F)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' U');window.rubicCube.up(1)">é¡¶é¢(U)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' B');window.rubicCube.back(-1)">èƒŒé¢(B)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' D');window.rubicCube.bottom(-1)">åº•é¢(D)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' L');window.rubicCube.left(1)">å·¦è¾¹(L)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' R');window.rubicCube.right(-1)">å³é¢(R)</button>
					</div>
					<div>
						<div>é€†æ—¶é’ˆ</div>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' F\'');window.rubicCube.front(-1)">å‰é¢(F')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' U\'');window.rubicCube.up(-1)">é¡¶é¢(U')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' B\'');window.rubicCube.back(1)">èƒŒé¢(B')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' D\'');window.rubicCube.bottom(1)">åº•é¢(D')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' L\'');window.rubicCube.left(-1)">å·¦è¾¹(L')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' R\'');window.rubicCube.right(1)">å³é¢(R')</button>
					</div>
					<br/>
					<b id="rubic-formular">å…¬å¼ :</b>
					<br/>
					<div class="help-content">åœ¨ä¸‹é¢é­”æ–¹å±•å¼€å›¾ä¸­å¯ç”¨é¼ æ ‡ç»˜åˆ¶ä»»æ„å›¾æ¡ˆé¢œè‰²(æ³¨:ç”»ç¬”é¢œè‰²æ—¢å¯ä»¥æ˜¯é¢œè‰²è‹±æ–‡ï¼Œä¾‹å¦‚red, blue, orange, ä¹Ÿå¯æ˜¯#å¼€å¤´çš„RGB,ä¾‹å¦‚#FFABCD)</div>
					<label>ç”»ç¬”é¢œè‰²</label><input id="penColor" value="black"/>
					<label>ç”»ç¬”ç²—ç»†</label><input id="penWidth" value="3"/>
					<div id="expand"></div>
				</div>
			</div>
			<div id="music-container">
				<div id="music-capsule" class="capsule" data-expend=true>éŸ³ä¹</div>
				<div id="music-main" class="content-area" style="display: none;">
					<ul class="piano">
						<li onclick="play(130.81)" class="white"></li>
						<li onclick="play(138.59)" class="black"></li>
						<li onclick="play(146.83)" class="white sp"></li>
						<li onclick="play(155.56)" class="black"></li>
						<li onclick="play(164.81)" class="white sp"></li>
						<li onclick="play(174.61)" class="white"></li>
						<li onclick="play(185.00)" class="black"></li>
						<li onclick="play(196.00)" class="white sp"></li>
						<li onclick="play(207.65)" class="black"></li>
						<li onclick="play(220)" class="white sp"></li>
						<li onclick="play(233.08)" class="black"></li>
						<li onclick="play(246.94)" class="white sp"></li>
						<li onclick="play(261.63)" class="white"></li>
						<li onclick="play(277.18)" class="black"></li>
						<li onclick="play(293.66)" class="white sp"></li>
						<li onclick="play(311.13)" class="black"></li>
						<li onclick="play(329.63)" class="white sp"></li>
						<li onclick="play(349.23)" class="white"></li>
						<li onclick="play(366.99)" class="black"></li>
						<li onclick="play(392)" class="white sp"></li>
						<li onclick="play(415.30)" class="black"></li>
						<li onclick="play(440)" class="white sp"></li>
						<li onclick="play(466.16)" class="black"></li>
						<li onclick="play(493.88)" class="white sp"></li>
					</ul>
				</div>
			</div>
			<div id="blind-container">
				<div id="blind-capsule" class="capsule" data-expend=true>ç›²æ–‡&æ——è¯­</div>
				<div id="blind-main" class="content-area" style="display: none;">
					<div>ç›²æ–‡:</div>
					<div id="demo-blind-letter" style="margin-right: 5px;">
						<div style="display: flex;">
							<div>
								<div class="blind-dot" data-index=0 ></div>
								<div class="blind-dot" data-index=1 ></div>
								<div class="blind-dot" data-index=2 ></div>
							</div>
							<div>
								<div class="blind-dot" data-index=3 ></div>
								<div class="blind-dot" data-index=4 ></div>
								<div class="blind-dot" data-index=5 ></div>
							</div>
						</div>
						<div id="blind-letter"></div>
					</div>
					<button onclick="confirmBlind()" style="margin: 20px;">ç¡®è®¤</button>
					<div id="history-blind-area" style="display: flex;"></div>
					<div >æ——è¯­:</div>
					<div id="demo-flag">
						<div style="display: flex;">
							<div class="flag-shape " style="transform: rotate(-45deg);" data-index=0></div>
							<div class="flag-shape" data-index=1></div>
							<div class="flag-shape transparent" style="transform: rotate(45deg);" data-index=2></div>
						</div>
						<div style="display: flex;">
							<div class="flag-shape transparent" style="transform: rotate(-90deg);" data-index=3></div>
							<div style="width: 40px; height: 50px;" ></div>
							<div class="flag-shape transparent" style="transform: rotate(90deg);" data-index=4></div>
						</div>
						<div style="display: flex;">
							<div class="flag-shape transparent" style="transform: rotate(-135deg);" data-index=5></div>
							<div class="flag-shape transparent" style="transform: rotate(180deg);" data-index=6></div>
							<div class="flag-shape transparent" style="transform: rotate(135deg);" data-index=7></div>
						</div>
						<div id="flag-letter"></div>
					</div>
					<button onclick="confirmFlag()" style="margin: 20px;">ç¡®è®¤</button>
					<div id="history-flag-area" style="display: flex;"></div>
				</div>
			</div>
			<div id="cipher-container">
				<div id="cipher-capsule" class="capsule" data-expend=true>å¤å…¸å¯†ç </div>
				<div id="cipher-main" class="content-area" style="display: none;">
					<div id="cipher-tools">
						<button id="caeser-brute-force" style="margin: 20px;">æš´åŠ›å‡¯æ’’</button>
						<button id="QWE" style="margin: 20px;">QWE</button>
						<hr/>
						<div id="general-substitute-cipher">
							<select onchange="changeSubstitutionMethod()" id="substitution-cipher-method">
								<option value ="QWECipher">å­—æ¯åº(a = 1, b = 2)</option>
								<option value ="QWECipher">å­—æ¯åº(a = 01, b = 02)</option>
								<option value ="QWECipher">QWE</option>
								<option value ="QWECipher">Atbash</option>
								<option value ="QWECipher">5*5æ£‹ç›˜(i/jåŒæ ¼)</option>
								<option value ="QWECipher">æ‰‹æœºé”®ç›˜</option>
								<option value ="QWECipher">è«å°”æ–¯ç”µç (morse code)</option>
								<option value ="QWECipher">å…ƒç´ å‘¨æœŸè¡¨</option>
							</select>
							<textarea id="key-textarea" class="form-control" rows="4" oninput="onTypeKey()"></textarea>
							<button onclick="encode()">ç¼–ç </button>
							<button onclick="decode()">è§£ç </button>
						</div>
						<div style="margin: 10px;">å°†<input id="replace1"/> æ›¿æ¢æˆ <input id="replace2"/> <button onclick="replaceStr()">æ›¿æ¢</button></div>
						<button onclick="removeSpace()">å»ç©ºæ ¼</button>
						<div><input id="spaceCnt" value = "2" style="width: 40px;"/>ä¸ªä¸€ç»„<button onclick="addSpace()">åŠ ç©ºæ ¼</button></div>
					</div>
					<textarea id="cipher-code-textarea" class="form-control" rows="20" placeholder="è¯·è¾“å…¥å¯†æ–‡" oninput="onTypePlainCode()"></textarea>
					<div id="plain-code-area"></div>
				</div>
			</div>
			<div id="sudoku-container">
				<div id="sudoku-capsule" class="capsule" data-expend=true>æ•°ç‹¬ã€å¹»æ–¹ã€æ‰«é›·ã€nonogramã€Drop Quoteé»‘ç§‘æŠ€</div>
				<div id="sudoku-main" class="content-area" style="display: none;">
					<div>
						<select id ="solverMode" onchange="changeSolverMode()">
							<option value ="sudoku">ç»å…¸æ•°ç‹¬æ¨¡å¼</option>
							<option value ="mine">ç»å…¸æ‰«é›·</option>
							<option value = "magicSquare">ç»å…¸å¹»æ–¹</option>
							<option value = "nonogram">ç»å…¸nonogram</option>
							<option value = "drop">ç»å…¸drop</option>
							<option value = "simpLoop">ç»å…¸simple loop</option>
							<option value = "hashi">ç»å…¸hashi</option>
						</select>
					</div>
					<span>è¡Œ: </span> <span id="sudoku-row" style="border: 1px solid;" contenteditable="true">9</span>
					<span>åˆ—: </span> <span id="sudoku-col" style="border: 1px solid;" contenteditable="true">9</span>
					<a href="https://github.com/philippica/cipher_machine/wiki/%E7%84%96%E8%82%89%E9%9D%A2%E8%84%9A%E6%9C%AC%E6%96%87%E6%A1%A3">è„šæœ¬è§„åˆ™è¯´æ˜</a>
					<div><span>æ˜¾ç¤ºä¸Šæ’</span><input type="checkbox" id="show-upper" /></div>
					<div><span>æ˜¾ç¤ºå·¦æ’</span><input type="checkbox" id="show-left" /></div>
					<button id="dropHelper" style="display: none;">ä¸€é”®ç”Ÿæˆdropæˆå•è¯çš„è§„åˆ™(æŒ‰é»‘æ ¼éš”å¼€æˆå•è¯)</button>
					<div style="display:flex;">
						<textarea id="rules" cols="50" rows="30"></textarea>
						<div style="margin:20px;">
							<div style="display: none;" id="upperRules">
								<div style="font-size: 13px;">ä¸Šæ’åŒºåŸŸä¸­çš„å†…å®¹å°†è¢«æ›¿æ¢ä¸ºè§„åˆ™:</div>
								<textarea id="upReplaceStr" cols="50"></textarea>
							</div>
							<div style="display: none;" id="leftRules">
								<div style="font-size: 13px;">å·¦æ’åŒºåŸŸä¸­çš„å†…å®¹å°†è¢«æ›¿æ¢ä¸ºè§„åˆ™:</div>
								<textarea id="leftReplaceStr" cols="50"></textarea>
							</div>
							<div>
								<div style="font-size: 13px;">ä¸‹é¢æ ¼å­ä¸­çš„å†…å®¹å°†è¢«æ›¿æ¢ä¸ºè§„åˆ™:</div>
								<textarea id="replaceStr" cols="50"></textarea>
							</div>
							<div id="showcase" style="width: fit-content;">
								<div id="sudoku-upper"></div>
								<div style="display: flex;">
									<div id="sudoku-left"></div>
									<div id="sudokuContainer"></div>
								</div>
							</div>
							<pre id="sudokuAnswer"></pre>
						</div>
					</div>
					<button id="solveSudoku">solve</button>
				</div>
			</div>
			<div id="cvs-container">
				<div id="cvs-capsule" class="capsule" data-expend=true>å›¾ç‰‡å¤„ç†</div>
				<div id="cvs-main" class="content-area" style="display: none;">
					<canvas id="cvs"></canvas>
					<div id="cvs-details" style="margin: 10px;"></div>
					<div id="cvs-tools">
						<div>
							<span id="zoom">ğŸ”</span>
							<span id="pen">âœ</span>
						</div>
						<div>
							<span id="zoom">ğŸ”</span>
							<span id="pen">âœ</span>
						</div>
					</div>
					<div id="cvs-rgb" style="display: none;">
						<div><b>çº¢è‰²é€šé“ R</b></div>
						<canvas id="cvs-r"></canvas>
						<div><b>ç»¿è‰²é€šé“ G</b></div>
						<canvas id="cvs-g"></canvas>
						<div><b>è“è‰²é€šé“ B</b></div>
						<canvas id="cvs-b"></canvas>
					</div>
				</div>
			</div>
		</div>
		<div id="footer"> power by -- philippica (Contact me: philippicapyj@gmail.com)</div>
		<script src="<%= htmlWebpackPlugin.files.js[0] %>"></script>
		<script src="./static/jquery.min.js"></script>
		<script>
			$('h3').text("å­—å…¸å°šåœ¨åŠ è½½,éƒ¨åˆ†åˆ©ç”¨åˆ°å­—å…¸çš„åŠŸèƒ½æš‚ä¸å¯ç”¨,è¯·ç¨ç­‰ç‰‡åˆ»,å¦‚æœå®åœ¨å¤ªæ…¢,å¯ä¸‹è½½æœ¬é¡µé¢åˆ°ç”µè„‘æœ¬åœ°ä½¿ç”¨");
			if(localStorage.abc) {
				window.words = {};
				for (let i = 0, len = localStorage.length; i < len; i++) {
					const key = localStorage.key(i);
					words[key] = localStorage.getItem(key).split(",");
				}
				$('h3').remove();
			}
			// substitution
			$(".capsule").click((e) => {
				const target = e.target;
				const content = $(target.parentElement.lastElementChild);
				if(content.is(":visible")) {
					content.hide("fast", "linear");
				} else {
					content.show("fast", "linear");
				}
			});


			let rubicCubeMaterias;

			$("#rubik-cube-capsule").click((e) => {
				if(!window.rubicCube) {
					const materias = initExpand();
					rubicCubeMaterias = materias
					const rubikCanvas = document.getElementById('rubik-cube'),
					rubikCtx = rubikCanvas.getContext('2d');
					window.rubicCube = new Solver.RubikCubeStage(rubikCtx, rubikCanvas.width, rubikCanvas.height, rubicCubeMaterias);
				}
			});

			$("#substitution-solver-btn").click(function(){
				var content = $("#content").val();
				console.info(content);
				plaintext = new Solver.SubstitutionSolver().substituteSolver(content)
				$("#substitution-answer").empty();
				if(plaintext.length === 0) {

				}
				for(let i = 0; i < Math.min(plaintext.length, 100); i++) {
					$("#substitution-answer").append(`<div><b>${plaintext[i]}</b></div>`);
				}
			});

			// one word
			let solver = new Solver.OneWord();
			const oneWordHelpContent = {
				"findByWildcard": "å½“å‰æ˜¯é€šé…ç¬¦æ¨¡å¼ - ä½ å¯ä»¥ä½¿ç”¨#è¡¨ç¤ºä¸€ä¸ªå­—æ¯, ç”¨*è¡¨ç¤ºå¤šä¸ªå­—æ¯ ä¾‹å¦‚ bo##ke*r å¯ä»¥åŒ¹é…åˆ°bookkeeper\n\tæ–¹æ‹¬å·[]å¯ä»¥ç”¨æ¥åŒ¹é…ä¸€ç»„å¯èƒ½çš„æ•°å­—ï¼Œä¾‹å¦‚ booke[rd] ä¼šåŒæ—¶åŒ¹é…åˆ°bookedå’Œbooker\n\tå¤§å†™å­—æ¯è¡¨ç¤ºç›¸åŒçš„ä¸€ç»„è¯ï¼Œä¾‹å¦‚pBAtAsBAp ç¬¬2ç¬¬7ä¸ªå­—æ¯ç›¸åŒï¼Œç¬¬3,5,8ä¸ªå­—ç¬¦ç›¸åŒï¼Œå½“é€‰ä¸¤ä¸ªè¯çš„æ—¶å€™èƒ½å¤ŸåŒ¹é…åˆ°photo shop",
				"findByRegularExpression": "å½“å‰æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ - å¦‚æœä½ ç†Ÿæ‚‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£å®ƒå°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…· ä¾‹å¦‚^[abcd][ef].*[aeiou]$ èƒ½å¤Ÿæœåˆ°ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºabcdä¸­ä¸€ä¸ªï¼Œç¬¬äºŒä¸ªå­—æ¯ä¸ºefä¸­ä¸€ä¸ªï¼Œå¹¶ä¸”ä»¥å…ƒéŸ³ç»“å°¾çš„æ‰€æœ‰å•è¯\n\nä¾‹å¦‚å¯»æ‰¾ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œç¬¬å››ä¸ªå­—ç¬¦ç›¸åŒç¬¬äºŒä¸ªå­—ç¬¦ä¸ºbçš„é•¿åº¦ä¸º8çš„å•è¯ ^(.)b.\\1....$ è§£é‡Šï¼š(å…¶ä¸­\\1è¡¨ç¤ºä»å·¦åˆ°å³ç¬¬ä¸€ä¸ªæ‹¬å·éœ€è¦å’Œå®ƒç›¸åŒ .ä»£è¡¨ä»»æ„å­—ç¬¦ ^ $åˆ†åˆ«ä»£è¡¨å¤´å’Œå°¾)\n\nä¾‹å¦‚å¯»æ‰¾é•¿åº¦ä¸º4çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œç¬¬å››ä¸ªå­—ç¬¦ç›¸åŒï¼Œç¬¬äºŒä¸ªå­—ç¬¦å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦ç›¸åŒçš„å•è¯: ^(.)(.)\\2\\1$\n\nä¾‹å¦‚å¯»æ‰¾ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å…ƒéŸ³ï¼Œä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦ç›¸åŒï¼Œé•¿åº¦ä¸å®šï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä¸å¯èƒ½æ˜¯bæˆ–è€…cçš„å•è¯ ^([aeiou])[^bc]\\1\n",
				"contains": "å½“å‰æ˜¯åŒ…å«æ¨¡å¼ - èƒ½å¤Ÿæœå‡ºæ‰€æœ‰è‡³å°‘åŒ…å«è¿™äº›å­—æ¯çš„å•è¯ï¼Œä¾‹å¦‚abbccä¼šæ‰¾åˆ°æ‰€æœ‰è‡³å°‘åŒ…å«ä¸€ä¸ªaä¸¤ä¸ªbå’Œä¸¤ä¸ªcçš„å•è¯",
				"findSimilarity": "å½“å‰æ˜¯ç›¸ä¼¼åº¦æ¨¡å¼-ç»™å‡ºå•è¯æ‰¾åˆ°ä¸å®ƒç›¸æƒ³çš„å•è¯ï¼Œä¸¤ä¸ªè¯ç›¸ä¼¼åº¦å³ç¼–è¾‘è·ç¦»ï¼Œå¦‚æœèƒ½é€šè¿‡ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªå­—æ¯ï¼Œæ›¿æ¢ä¸€ä¸ªå­—æ¯æˆ–åˆ é™¤ä¸€ä¸ªå­—æ¯èƒ½ä»ä¸€ä¸ªå•è¯å˜æˆå¦ä¸€ä¸ªå•è¯ï¼Œé‚£å®ƒä»¬çš„ç›¸ä¼¼åº¦ä¸º1",
				"findByCode": "æœ€çµæ´»çš„æ‰¾è¯æ–¹å¼ï¼Œé€šè¿‡è‡ªå·±ç¼–å†™jsä»£ç ï¼Œå®ç°ä¸€ä¸ªæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°çš„checkå‡½æ•°æ¥å¯»æ‰¾å•è¯\nå‡½æ•°åŒæ—¶ä¼šä¼ å…¥ä¸€ä¸ªtoolçš„å‚æ•°ï¼ŒåŒ…å«å¾ˆå¤šæœ‰ç”¨å‡½æ•°ï¼Œå½“å‰åŒ…æ‹¬:\n\tisWord(str: string) :bool : åˆ¤æ–­ä¼ å…¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºè‹±è¯­å•è¯\n\tanagram(str: string, letters: string) :bool : åˆ¤æ–­ä¼ å…¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºletterså‚æ•°ä¸­çš„å­—ç¬¦æ’åˆ—ç»„æˆ"
			};
			let method = "findByWildcard";
			$("#help-content").text(oneWordHelpContent[method]);
			const changeMethod = () => {
				const methodStr = $("#find-method").val()
				method = methodStr;
				$('#word-find-similarity-hint').remove();
				$('#similarityRegex').remove();
				$("#similarityDegree").remove();
				$("#twoWordContainer").remove();
				$("#one-word-content").height(60);
				if(method === "findSimilarity") {
					$("#method-select").append("<input id='similarityDegree' placeholder='ç›¸ä¼¼åº¦' value='1'/>");
					$("#method-select").append("<div id='word-find-similarity-hint'>åœ¨ç»“æœä¸­ç”¨æ­£åˆ™æŸ¥æ‰¾:</div><input id='similarityRegex' placeholder='æ­£åˆ™è¡¨è¾¾å¼(ä¸å¡«åˆ™è¾“å‡ºæ‰€æœ‰ç»“æœ)' />");
				} else if(method === 'contains') {
					$("#method-select").append("<div id='word-find-similarity-hint'>åœ¨ç»“æœä¸­ç”¨æ­£åˆ™æŸ¥æ‰¾:</div><input id='similarityRegex' placeholder='æ­£åˆ™è¡¨è¾¾å¼(ä¸å¡«åˆ™è¾“å‡ºæ‰€æœ‰ç»“æœ)' />");
				} else if(method === "findByCode") {
					$("#one-word-content").val('function check(str, tools) {\n\tif(str[0]!=str[str.length-1])return null; // å¦‚æœé¦–å­—æ¯å’Œå°¾å­—æ¯ä¸ç›¸ç­‰ï¼Œä¸é€‰è¿™ä¸ªå•è¯\n\tif(str.length > 7 || str.length < 5)return null; // å¦‚æœå•è¯é•¿åº¦å¤§äº7æˆ–è€…å°äº2ï¼Œä¸é€‰è¿™ä¸ªå•è¯\n\tif(/^a.*b$/.test(str))return null;// å¦‚æœæ»¡è¶³æ­£åˆ™^a.*b$ ä¸é€‰è¿™ä¸ªå•è¯\n\tif(tools.anagram(str.substr(2,3), "guo") === false)return null; // å¦‚æœä»ç¬¬3ä¸ªå­—ç¬¦èµ·å¾€å3ä¸ªå­—æ¯ä¸æ˜¯ç”±abcç»„æˆçš„ï¼Œä¸é€‰è¿™ä¸ªå•è¯\n\tif(tools.isWord(str.substr(2,5)) === true){ // å¦‚æœå•è¯ç¬¬3ä¸ªå­—ç¬¦ï¼ˆå› ä¸ºä¸‹æ ‡ä»0å¼€å§‹)å¾€å5ä¸ªå­—æ¯æ˜¯ä¸€ä¸ªè‹±è¯­å•è¯\n\t\treturn str + " " + str.substr(2,5); //è¾“å‡ºè¯¥è¯ï¼Œå¹¶æŠŠç¬¬ä¸‰ä¸ªåˆ°ç¬¬5ä¸ªå­—æ¯çš„å­—ä¸²æ”¾åé¢\n\t}\n}');
					$("#one-word-content").height(400);
				} else if(method === "findByWildcard") {
					$("#method-select").append(`<div id="twoWordContainer"><span>ä¸¤ä¸ªè¯</span><input type="checkbox" id="twoWords" /></div>`);
				}
				$("#help-content").text(oneWordHelpContent[method]);
			}
			$("#find-words").click(async function(){
				let content = $("#one-word-content").val();
				let answer;
				$("#words-list").empty();
				if(method !== "contains") {
					for(let i = 20; i >= 1; i--) {
					 	$("#words-list").append(`<div id="len-${i}" style="display: none;" class="word-content"><b style="display: block">é•¿åº¦ä¸º${i}:</b></div>`);
					}
				} else {
					for(let i = 1; i <= 20; i++) {
					 	$("#words-list").append(`<div id="len-${i}" style="display: none;" class="word-content"><b style="display: block">é•¿åº¦ä¸º${i}:</b></div>`);
					}
				}
				let count = 0;
				const findWord = async (wordLength, word) => {
					function sleep(ms) {
						return new Promise(resolve => setTimeout(resolve, ms));
					}
					const target = $(`#words-list #len-${wordLength}`);
					if(!target.is(":visible")) {
						target.show("fast", "linear");
					}
					target.append(`<div>${word}</div>`);
					count++;
					$('#word-list-count').html(`å…±${count}ä¸ª`);
					if(count % 1000 === 0) {
						await sleep(1);
					}
				}
				let filter = 0;
				if($("#noun").is(':checked')) filter |= 1;
				if($("#verb").is(':checked')) filter |= 2;
				if($("#adj").is(':checked')) filter |= 4;
				if($("#adv").is(':checked')) filter |= 8;
				if($("#lowfrequcy").is(':checked')) filter |= 16;

				const solverFunc = new Solver.OneWord()[method].bind(solver);
				if(method === "findSimilarity") {
					const regex = $('#similarityRegex').val();
					let regularExpression;
					if(regex && regex !== '') {
						regularExpression = eval(`/${regex}/`);
					}
					findSimilarity = async (wordLength, word) => {
						if(regularExpression && !regularExpression.test(word)) {
							return;
						}
						await findWord(wordLength, word);
					}
					const similarityDegree = parseInt($("#similarityDegree").val());
					answer = await solverFunc(content, similarityDegree, findSimilarity, filter)
				} else if(method === 'contains') {
					const regex = $('#similarityRegex').val();
					let regularExpression;
					if(regex && regex !== '') {
						regularExpression = eval(`/${regex}/`);
					}
					findSimilarity = async (wordLength, word) => {
						if(regularExpression && !regularExpression.test(word)) {
							return;
						}
						await findWord(wordLength, word);
					}
					answer = await solverFunc(content, findSimilarity, filter)
				} else if(method === 'findByWildcard') {
					const twoWords = $("#twoWords").is(':checked');
					answer = await solverFunc(content, findWord, filter, twoWords);
				} else {
					answer = await solverFunc(content, findWord, filter)
				}
			});

			// word search
			wordSearch = () => {
				var content = $("#word-search-content").val();
				$("#word-search-ansers-list").html("");
				$("#word-search-ansers-position").html("");
				console.info(content);
				const mat = new Solver.WordSearch().buildMatrix(content);
				const col = mat[0].length;
				let id = 0;
				$("#word-search-mat").html("");
				$("#word-search-mat").css("width", `${col * 26 + col*2 + 10}px`);
				for(const row of mat) {
					for(const ch of row) {
						$("#word-search-mat").append(`<div id="ws-${id}" class="sudoku-grid-content">${ch}</div>`);
						id++;
					}
				}
				let answer;
				if($('#onlyvh').get(0).checked) {
					answers = new Solver.WordSearch().wordSearch(mat);
				} else {
					answers = new Solver.WordSearch().wordSearch2(mat);
				}
				answers.sort((a, b) => b.word.length !== a.word.length ? b.word.length - a.word.length : b.word < a.word);
				let lastans = "";
				for(let answer of answers) {
					if(answer.word == lastans)continue;
					let dirFirst = "";
					let dirSecond = "";
					if(answer.dy === 1) {
						dirFirst = "å³";
					} else if(answer.dy === -1) {
						dirFirst = "å·¦";
					}
					if(answer.dx === 1) {
						dirSecond = "ä¸‹";
					} else if(answer.dx === -1) {
						dirSecond = "ä¸Š";
					}
					$("#word-search-ansers-list").append(`<div>${answer.word}</div>`);
					if($('#onlyvh').get(0).checked) {
						$("#word-search-ansers-position").append(
							`<div class="ws-answer" data-answer="${JSON.stringify(answer).replace(/\"/g,"'")}">å‡ºç°åœ¨ç¬¬${answer.x+1}è¡Œï¼Œç¬¬${answer.y+1}åˆ—ï¼Œå‘${dirFirst}${dirSecond}æ–¹å‘</div>`
						);
					} else {
						$("#word-search-ansers-position").append(
							`<div class="ws-answer" data-answer="${JSON.stringify(answer.pos)}">ä»ç¬¬${parseInt(answer.pos[0] / col) + 1}è¡Œï¼Œç¬¬${answer.pos[0] % col + 1}åˆ—å¼€å§‹</div>`
						);
					}
					lastans = answer.word;
				}
				$(".ws-answer").on("click", (e) => {
					const r = Math.round(Math.random() * 255);
					const g = Math.round(Math.random() * 255);
					const b = Math.round(Math.random() * 255);
					let color = "rgb(" + r + "," + g + ',' + b + ')';
					const answer = JSON.parse(e.target.dataset.answer.replace(/\'/g,"\""));
					if(e.target.style.backgroundColor) {
						color = e.target.style.backgroundColor;
						e.target.style.backgroundColor = "";
					} else e.target.style.backgroundColor = color;
					if(e.target.dataset.answer[0] == '[') {
						for(const idx of answer) {
							const originColor = $(`#ws-${idx}`).css("background-color");
							if(!originColor) {
								$(`#ws-${idx}`).css("background-color", color);
							} else {
								const backgroundRGB = originColor.match(/\d+/g);
								const backgroundR = parseInt(backgroundRGB[0]);
								const backgroundG = parseInt(backgroundRGB[1]);
								const backgroundB = parseInt(backgroundRGB[2]);

								const otherRGB = color.match(/\d+/g);
								const otherR = parseInt(otherRGB[0]);
								const otherG = parseInt(otherRGB[1]);
								const otherB = parseInt(otherRGB[2]);
								const xorColor = `rgb(${backgroundR^otherR},${backgroundG^otherG},${backgroundB^otherB})`;
								if(xorColor == "rgb(0,0,0)") {
									$(`#ws-${idx}`).css("background-color", "");
								}else
								$(`#ws-${idx}`).css("background-color", xorColor);
							}
						}
						return;
					}
					const len = answer.word.length;
					let x = answer.x;
					let y = answer.y;
					for(let i = 0; i < len; i++) {
						const idx = x * col + y;
						const originColor = $(`#ws-${idx}`).css("background-color");
						if(!originColor) {
							$(`#ws-${idx}`).css("background-color", color);
						} else {
							const backgroundRGB = originColor.match(/\d+/g);
							const backgroundR = parseInt(backgroundRGB[0]);
							const backgroundG = parseInt(backgroundRGB[1]);
							const backgroundB = parseInt(backgroundRGB[2]);

							const otherRGB = color.match(/\d+/g);
							const otherR = parseInt(otherRGB[0]);
							const otherG = parseInt(otherRGB[1]);
							const otherB = parseInt(otherRGB[2]);
							const xorColor = `rgb(${backgroundR^otherR},${backgroundG^otherG},${backgroundB^otherB})`;
							if(xorColor == "rgb(0,0,0)") {
								$(`#ws-${idx}`).css("background-color", "");
							}else
							$(`#ws-${idx}`).css("background-color", xorColor);
						}
						x += answer.dx;
						y += answer.dy;
					}
				});
			}

			// rubik cube
			initExpand = () => {
				const blocks = [];
				for(let i = 0; i < 4; i++) {
					$('#expand').append(`<div id="expand-${i}" class="face-container"></div>`);
				}
				$('#expand-0').append(`<div id="face-${0}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${1}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${2}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${3}" class="face"></div>`);
				$('#expand-2').append(`<div id="face-${4}" class="face"></div>`);
				$('#expand-3').append(`<div id="face-${5}" class="face"></div>`);
				const width = Math.floor($('#face-1').width() / 3-4);
				const height = Math.floor($('#face-1').height() / 3-4);
				const blockNum = 9;
				const colors = ["white", "green", "red", "blue", "yellow", "orange"]
				for(let i = 0; i < 6; i++) {
					for(let j = 0; j < blockNum; j++) {
						$(`#face-${i}`).append(`<canvas id="block-${i*blockNum+j}" width="${width}px" height="${height}px" class="cube-block"></canvas>`);
						let canvas = document.getElementById(`block-${i*blockNum+j}`);
						let ctx=canvas.getContext("2d");
						ctx.fillStyle=colors[i];
						ctx.fillRect(0,0,width,height);
						const index = i*blockNum+j;
						ctx.fillStyle="black";
						ctx.font="20px Georgia";
						ctx.fillText (index.toString(), 20,20);
						blocks.push(canvas);
					}
				}
				return blocks;
			}
			resetRubicCube = () => {
				$('#rubic-formular').html('å…¬å¼: ')
				const rubikCanvas = document.getElementById('rubik-cube'),
				rubikCtx = rubikCanvas.getContext('2d');
				window.rubicCube = new Solver.RubikCubeStage(rubikCtx, rubikCanvas.width, rubikCanvas.height, rubicCubeMaterias);
			}

			//music
			const play = async (tone) => {
				window.AudioContext = window.AudioContext || window.webkitAudioContext;
				var context = new AudioContext();
				let playSound =  async (arr, channel) => {
					var buf = new Float32Array(arr.length)
					for (var i = 0; i < arr.length; i++) buf[i] = arr[i]
					var buffer = context.createBuffer(1, buf.length, context.sampleRate)
					buffer.copyToChannel(buf, channel)
					var source = context.createBufferSource();
					source.buffer = buffer;
					source.connect(context.destination);
					await source.start();
				}
				let sin = (x) => {
					return Math.sin(x);
				}

				let exp = (x) => {
					return Math.exp(x);
				}

				const PI = Math.PI;

				const decay = (x, degree) => {
					let ret = 1;
					for(let i = 0; i < degree; i++) {
						ret = ret * x / context.sampleRate;
					}
					return exp(-10 * ret);
				}

				function sineWaveAt(x, tone) {
				var sampleFreq = context.sampleRate / tone;
					return sin(2*PI*x / (sampleFreq )) * decay(x, 3) ;
				}

				var arr = [], arr2 = []
				volume = 0.1,
				seconds = 1;

				for (var i = 0; i < context.sampleRate * seconds; i++) {
					arr[i] = sineWaveAt(i, tone) * volume
					arr[i] += sineWaveAt(i, tone*2) * volume * 0.4;
					arr[i] += sineWaveAt(i, tone*3) * volume * 0.2;
				}

				playSound(arr, 0);
		}

			// blind
			const currentBlindState = [0,0,0,0,0,0];
			const braille = [];
			braille[1] = 'a';braille[3] = 'b';
			braille[9] = 'c';braille[25] = 'd';
			braille[17] = 'e';braille[11] = 'f';
			braille[27] = 'g';braille[19] = 'h';
			braille[10] = 'i';braille[26] = 'j';
			braille[5] = 'k';braille[7] = 'l';
			braille[13] = 'm';braille[29] = 'n';
			braille[21] = 'o';braille[15] = 'p';
			braille[31] = 'q';braille[23] = 'r';
			braille[14] = 's';braille[30] = 't';
			braille[37] = 'u';braille[39] = 'v';
			braille[58] = 'w';braille[45] = 'x';
			braille[61] = 'y';braille[53] = 'z';


			$('.blind-dot').on("click",function(e)
			{
				const idx = parseInt(e.target.dataset.index);
				if(currentBlindState[idx]) {
					e.target.style.backgroundColor=""
				} else {
					e.target.style.backgroundColor="black"
				}
				currentBlindState[idx] ^= 1;

				let code = 0;
				for(let i = 0; i < 6; i++) {
					code += currentBlindState[i] * (1<<i);
				}
				if(braille[code]) {
					$("#blind-letter").text(braille[code]);
				} else {
					$("#blind-letter").text("Unknown");
				}
			});

			const confirmBlind = () => {
				$("#history-blind-area").append($("#demo-blind-letter").clone());
			}
			const confirmFlag = () => {
				$("#history-flag-area").append($("#demo-flag").clone());
			}

			const flagState = [0, 1];
			const flagMap = [];
			flagMap[51] = 'a';flagMap[33] = 'b';
			flagMap[6] = 'c';flagMap[15] = 'd';
			flagMap[24] = 'e';flagMap[42] = 'f';
			flagMap[61] = 'g';flagMap[32] = 'h';
			flagMap[5] = 'i';flagMap[13] = 'j';
			flagMap[14] = 'k';flagMap[23] = 'l';
			flagMap[41] = 'm';flagMap[52] = 'n';
			flagMap[3] = 'o';flagMap[12] = 'p';
			flagMap[21] = 'q';flagMap[31] = 'r';
			flagMap[34] = 's';flagMap[1] = 't';
			flagMap[2] = 'u';flagMap[16] = 'v';
			flagMap[22] = 'w';flagMap[25] = 'x';
			flagMap[4] = 'y';flagMap[43] = 'z';

			$('.flag-shape').on("click",function(e)
			{
				const idx = parseInt(e.target.dataset.index);
				if(flagState[0] === idx || flagState[1] === idx)return;
				e.target.style.opacity=1;
				$(`.flag-shape[data-index=${flagState[0]}]`)[0].style.opacity=0.1;
				flagState[0] = flagState[1];
				flagState[1] = idx;

				const code = Math.min(flagState[0], flagState[1])*9 + Math.max(flagState[0], flagState[1]);
				console.info(code);
				if(flagMap[code]) {
					$("#flag-letter").text(flagMap[code]);
				} else {
					$("#flag-letter").text("Unknown");
				}
			});

			// classic Code

			const caeser = (str, offset) => {
				let ans = "";
				for(let ch of str) {
					let base;
					if(ch.charCodeAt() >= 65 && ch.charCodeAt() <= 90) {
						base = 65;
					} else if (ch.charCodeAt() >= 97 && ch.charCodeAt() <= 122) {
						base = 97;
					} else {
						ans += ch;
					}
					ans += String.fromCharCode((ch.charCodeAt() - base + offset) % 26 + base);
				}
				return ans;
			}

			const removeSpace = () => {
				const cipherCode = $("#cipher-code-textarea").val();
				$("#cipher-code-textarea").val(cipherCode.replaceAll(" ", ''));
			}

			const addSpace = () => {
				const chunk =(str, n)=> {
					var ret = [];
					var i;
					var len;

					for(i = 0, len = str.length; i < len; i += n) {
						ret.push(str.substr(i, n))
					}
					return ret
				};
				const cipherCode = $("#cipher-code-textarea").val();
				const count = parseInt($('#spaceCnt').val());
				$("#cipher-code-textarea").val(chunk(cipherCode, count).reduce((x, y)=>x+' '+y));

			}

			const caeserProcess = () => {
				const cipherCode = $("#cipher-code-textarea").val();
				$('#plain-code-area').empty();
				for(let i = 1; i <= 25; i++) {
					const pt = caeser(cipherCode, i)
					$('#plain-code-area').append(`<div style="display:flex;"><div>å‡¯æ’’${i}ï¼š </div><div>${pt}</div></div>`);
				}
			}

			const makeMap = (mapList) => {
				const ret = {};
				for(let i = 0; i < 26; i++) {
					ret[String.fromCharCode(i+97)] = mapList[i];
				}
				return ret;
			} 


			$('#caeser-brute-force').on("click",function(e)
			{
				caeserProcess();
			});

			const replaceStr = () => {
				const cipherText = $('#cipher-code-textarea').val();
				$('#cipher-code-textarea').val(cipherText.replaceAll($('#replace1').val(), $('#replace2').val()));
			}

			decodeProcess = (key1, key2, ct) => {
				key1 = key1.trim().replaceAll('  ', ' ').split(' ');
				key2 = key2.trim().replaceAll('  ', ' ').split(' ');
				const keyLen = key1.length;
				const cipherText = ct || $('#cipher-code-textarea').val();
				let plainText = '';
				for(let i = 0; i < cipherText.length;) { // TODO: AC automaton instead of brute force
					let match = -1;
					for(let j = 0; j < keyLen; j++) {
						if(cipherText.startsWith(key1[j], i)) {
							if(match == -1) {
								match = j;
								continue;
							}
							if(key1[match].length < key1[j].length) {
								match = j;
							}
						}
					}
					if(match == -1) {
						plainText += cipherText[i];
						i++;
					} else {
						i += key1[match].length;
						plainText += key2[match] + ' ';
					}
				}
				return plainText;
				$('#plain-code-area').html(`<div style="display:flex;">ç»“æœ: ${plainText}</div>`);
			}

			const decode = () => {
				const key = $("#key-textarea").val().split('\n');
				$('#plain-code-area').html(`<div style="display:flex;">ç»“æœ: ${decodeProcess(key[1], key[0])}</div>`);
			}

			const encode = () => {
				const key = $("#key-textarea").val().split('\n');
				$('#plain-code-area').html(`<div style="display:flex;">ç»“æœ: ${decodeProcess(key[0], key[1])}</div>`);
			}

			const substitutionTable = [
				'q w e r t y u i o p a s d f g h j k l z x c v b n m',
				'a b c d e f g h i j k l m n o p q r s t u v w x y z',
				'11 12 13 14 15 21 22 23 24 24 25 31 32 33 34 35 41 42 43 44 45 51 52 53 54 55',
				'21 22 23 31 32 33 41 42 43 51 52 53 61 62 63 71 72 73 74 81 82 83 91 92 93 94',
				'1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26',
				'01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26',
				'0 1 2 3 4 5 6 7 8 9',
				'.- -... -.-. -.. . ..-. --. .... .. .--- -.- .-.. -- -. --- .--. --.- .-. ... - ..- ...- .-- -..- -.-- --..',
				'----- .---- ..--- ...-- ....- ..... -.... --... ---.. ----.',
				'h he li be b c n o f ne na mg al si p s cl ar k ca sc ti v cr mn fe co ni cu zn ga ge as se br kr rb sr y zr nb mo tc ru rh pd ag cd in sn sb te i xe cs ba la ce pr nd pm sm eu gd tb dy ho er tm yb lu hf ta w re os ir pt au hg tl pb bi po at rn fr ra ac th pa u np pu am cm bk cf es fm md no lr rf db sg bh hs mt ds rg cn uut fl uup lv uus uuo',
				'â  â ƒ â ‰ â ™ â ‘ â ‹ â › â “ â Š â š â … â ‡ â  â  â • â  â Ÿ â — â  â  â ¥ â § â º â ­ â ½ â µ',
			];


			const useMethod = (method) => {
				let str = '';
				switch(method) {
				case 0:
					str += substitutionTable[1] + '\n' + substitutionTable[4];
					break;
				case 1:
					str += substitutionTable[1] + '\n' + substitutionTable[5];
					break;
				case 2:
					str += substitutionTable[1] + '\n' + substitutionTable[0];
					break;
				case 3:
					str += substitutionTable[1] + '\n' + substitutionTable[1].split('').reverse().join('');
					break;
				case 4:
					str += substitutionTable[1] + '\n' + substitutionTable[2];
					break;
				case 5:
					str += substitutionTable[1] + '\n' + substitutionTable[3];
					break;
				case 6:
					str += substitutionTable[1] + ' ' + substitutionTable[6] + '\n' + substitutionTable[7] + ' ' + substitutionTable[8];
					break;
				case 7:
					let numbers = "1";
					for(let i = 2; i <= 118; i++) {
						numbers += ' ' + i.toString();
					}
					str += numbers + '\n' + substitutionTable[9];
					break;
				case 8:
					str += substitutionTable[1] + '\n' + substitutionTable[10];
					break;
				}
				return str;
			}
			
			const changeSubstitutionMethod = () => {
				const methodIndex = $("#substitution-cipher-method")[0].selectedIndex;
				$('#key-textarea').val(useMethod(methodIndex));

			}
			changeSubstitutionMethod();

			const onTypePlainCode = (e) => {
				const isAutoDecode = $('#autoDecode').get(0).checked;
				if(!isAutoDecode)return;
				caeserProcess();
				let pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[0]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>QWEåŠ å¯†ï¼š </div><div>${pt}</div></div>`);

				pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[1]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>QWEè§£å¯†ï¼š </div><div>${pt}</div></div>`);

				pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[2]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>Atbashï¼š </div><div>${pt}</div></div>`);
			}

			$('#substitution-cipher-method').ready(() => {
				$('#key-textarea').val(useMethod(0));
			});

			const substituteCipher = (str, mapT) => {
				let mappingTable = mapT
				if(!mapT) {
					mappingTable = $.map($(".map-unit #cipher-text"), (element, i) => 
						{
							const pt = element.dataset.pt;
							const ret = {};
							ret[pt] = element.value;
							return ret;
						}
					).reduce((pre, cur) => {
						return Object.assign(pre, cur);
					});
				}

				let ans = "";
				for(let ch of str) {
					if(mappingTable[ch]) {
						ans += mappingTable[ch];
					} else if(mappingTable[ch.toLowerCase()]) {
						ans += mappingTable[ch.toLowerCase()];
					} else {
						ans += ch;
					}
				}
				return ans;
			}

			const solveGeneralSubstitution = () => {
				const cipherCode = $("#cipher-code-textarea").val();
				$('#plain-code-area').empty();
				const pt = substituteCipher(cipherCode);
				$('#plain-code-area').append(`<div style="display:flex;"><div>ç»“æœ: </div><div>${pt}</div></div>`);
			}

			const autoCheckClick = (e) => {
				const isAutoDecode = $('#autoDecode').get(0).checked;
				if(isAutoDecode) {
					$('#cipher-code-textarea')[0].style.borderColor = 'red';
					caeserProcess();
					substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[0]));

				} else {
					$('#cipher-code-textarea')[0].style.borderColor = '';
				}
			}
		// sudoku
		let n = parseInt($("#sudoku-row").html());
		let m = parseInt($("#sudoku-col").html());

		const updateRule = (replaceStr, text, replacedContent) => {
			const findStr = "^" + replaceStr.replace(replacedContent, ".*") + "$";
			const rulesStr = $('#rules').val().split('\n');
			let content = "";
			for(let i = 0; i < rulesStr.length; i++) {
				rulesWithoutSpace = rulesStr[i].replace(/\s/g, '');
				if(rulesWithoutSpace === "")continue;
				if(new RegExp(findStr.replace("[", "\\[").replace(']', "\\]")).test(rulesWithoutSpace)) {
					continue;
				}
				content += `${rulesWithoutSpace}\n`;
			}
			if(text != '') {
				content += replaceStr.replace(replacedContent, text) + `\n`;
			}
			$('#rules').val(content);
		}
		const generate = (n, m) => {
			$('#sudokuContainer').html("");
			$('#sudokuContainer').width(m*30 - m+2);
			$('#sudokuContainer').height(n*30 + n);
			for(let i = 0; i < n*m; i++) {
				$('#sudokuContainer').append(`<div class="sudoku-grid"><div class="sudoku-index">${i+1}</div><div id="grid-${i}" class="sudoku-grid-content" contenteditable="true"></div></div>`);
			}
			$('.sudoku-grid-content,#sudoku-row,#sudoku-col').on('focus', function() {
				before = $(this).html();
			}).on('blur keyup paste', function() { 
				if (before != $(this).html()) { before = $(this).html(); $(this).trigger('change'); }
			});

			$('.sudoku-grid-content').on('change', (e) =>{
				console.info(e.target.innerText);
				const text = e.target.innerText;
				const number = parseInt(e.currentTarget.id.substr(5)) + 1;
				console.info(number);
				const replaceStr = $("#replaceStr").val().replace("<æ ¼å­åºå·>", number.toString());
				updateRule(replaceStr, text, "<æ ¼å­å†…å®¹>");
			});

		}

		const initSudoku = () => {
			let initStr = 'æ¯ä¸€æ ¼æ˜¯ä»1åˆ°9çš„æ•°å­—\næ¯ä¸€è¡Œäº’ä¸ç›¸åŒ\næ¯ä¸€åˆ—äº’ä¸ç›¸åŒ\nç¬¬[1,2,3,10,11,12,19,20,21]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[4,5,6,13,14,15,22,23,24]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[7,8,9,16,17,18,25,26,27]æ ¼äº’ä¸ç›¸åŒ\n';
			initStr += 'ç¬¬[28,29,30,37,38,39,46,47,48]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[31,32,33,40,41,42,49,50,51]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[34,35,36,43,44,45,52,53,54]æ ¼äº’ä¸ç›¸åŒ\n';
			initStr += 'ç¬¬[55,56,57,64,65,66,73,74,75]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[58,59,60,67,68,69,76,77,78]æ ¼äº’ä¸ç›¸åŒ\nç¬¬[61,62,63,70,71,72,79,80,81]æ ¼äº’ä¸ç›¸åŒ\nç¬¬1æ ¼å¤§äº5\n';
			$('#replaceStr').val("ç¬¬<æ ¼å­åºå·>æ ¼æ˜¯<æ ¼å­å†…å®¹>");
			n = 9;
			m = 9;
			$("#rules").val(initStr);
			$("#sudoku-row").html(n);
			$("#sudoku-col").html(m);
			generate(n, m);
		}

		const changeSolverMode = () => {
			const modeStr = $("#solverMode").val();
			$('#dropHelper').css("display", "none");
			if($('#show-upper').get(0).checked) {
				$('#show-upper').click();
			}
			if($('#show-left').get(0).checked) {
				$('#show-left').click();
			}
			if(modeStr === "sudoku") {
				initSudoku();
			} else if (modeStr === "mine") {
				$('#replaceStr').val("ç¬¬<æ ¼å­åºå·>æ ¼çš„[æœ¬æ ¼,ä¸Š,ä¸‹,å·¦,å³,å·¦ä¸Š,å³ä¸Š,å·¦ä¸‹,å³ä¸‹]çš„é»‘æ ¼çš„æ•°é‡æ˜¯<æ ¼å­å†…å®¹>");
				$("#rules").val('æ¯ä¸€æ ¼æ˜¯ç™½æ ¼æˆ–é»‘æ ¼\næ²¡å¡«çš„æ ¼å­é»˜è®¤æ˜¯"ç¬¬<æ ¼å­åºå·>æ ¼çš„[æœ¬æ ¼,ä¸Š,ä¸‹,å·¦,å³,å·¦ä¸Š,å³ä¸Š,å·¦ä¸‹,å³ä¸‹]çš„é»‘æ ¼çš„æ•°é‡æ˜¯0"\n');
			} else if (modeStr === "magicSquare") {
				let initStr = 'æ¯ä¸€æ ¼æ˜¯ä»1åˆ°16çš„æ•°å­—\næ¯ä¸€æ ¼äº’ä¸ç›¸åŒ\næ¯ä¸€åˆ—çš„å’Œæ˜¯34\næ¯ä¸€è¡Œçš„å’Œæ˜¯34\n';
				$("#rules").val(initStr);
				n = 4;
				m = 4;
				$("#sudoku-row").html(n);
				$("#sudoku-col").html(m);
				$('#replaceStr').val("ç¬¬<æ ¼å­åºå·>æ ¼æ˜¯<æ ¼å­å†…å®¹>");
				generate(n, m);
			} else if (modeStr === "nonogram") {
				if(!$('#show-upper').get(0).checked) {
					$('#show-upper').click();
				}
				if(!$('#show-left').get(0).checked) {
					$('#show-left').click();
				}
				$('#upReplaceStr').val("ç¬¬<åˆ—å·>åˆ—ä»ä¸Šåˆ°ä¸‹è¿ç»­çš„é»‘æ ¼é•¿åº¦æ˜¯[<åˆ—åºåˆ—å†…å®¹>]");
				$('#leftReplaceStr').val("ç¬¬<è¡Œå·>è¡Œä»å·¦åˆ°å³è¿ç»­çš„é»‘æ ¼é•¿åº¦æ˜¯[<è¡Œåºåˆ—å†…å®¹>]");
				let content = "æ¯ä¸€æ ¼æ˜¯é»‘æ ¼æˆ–ç™½æ ¼\n";
				for(let i = 1; i <= n; i++) {
					content += `ç¬¬${i}è¡Œä»å·¦åˆ°å³è¿ç»­çš„é»‘æ ¼é•¿åº¦æ˜¯[0]\n`;
				}
				for(let i = 1; i <= m; i++) {
					content += `ç¬¬${i}åˆ—ä»ä¸Šåˆ°ä¸‹è¿ç»­çš„é»‘æ ¼é•¿åº¦æ˜¯[0]\n`;
				}
				$("#rules").val(content);
			} else if (modeStr === "drop") {
				$('#dropHelper').css("display", "unset");
				$('#replaceStr').val("ç¬¬<æ ¼å­åºå·>æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼");
				$('#upReplaceStr').val("ç¬¬<åˆ—å·>åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[<åˆ—åºåˆ—å†…å®¹>]çš„ä¸€ä¸ªæ’åˆ—");
				let content = "æ¯ä¸€æ ¼æ˜¯ä»aåˆ°zçš„å­—æ¯\nç¬¬5æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬10æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬15æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬23æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬28æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬33æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬37æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬43æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬46æ ¼å¼ºåˆ¶æ˜¯é»‘æ ¼\nç¬¬1åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[i,h,t,b,e]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬2åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[o,h,c,n,y]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬3åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[i,l]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬4åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[s,t,i,e,d]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬5åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[h,s,v]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬6åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[l,e,e,o]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬7åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[u,g,n,n]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬8åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[t,o,m,l]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬9åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[o,l,u,n,w]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬10åˆ—é™¤äº†é»‘æ ¼å¤–çš„æ ¼å­æ˜¯[a,s,h,e]çš„ä¸€ä¸ªæ’åˆ—\nç¬¬[1,2,3,4]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[6,7,8,9]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[11,12,13,14]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[16,17,18,19,20,21,22]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[24,25,26,27]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[29,30,31,32]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[34,35,36]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[38,39,40,41,42]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[44,45]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\nç¬¬[47,48,49,50]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\n";
				n = 5;
				m = 10;
				$("#sudoku-row").html(n);
				$("#sudoku-col").html(m);
				$("#rules").val(content);
				generate(n, m);
				if(!$('#show-upper').get(0).checked) {
					$('#show-upper').click();
				}
			} else if (modeStr === 'simpLoop') {
				let rule = "";
				const black = [1,18,86,154,155,222,38,123,125,91,159,260,8,59,144,195,61,112,146,197,231,282,199,63,46,32,51,68,136,286,237,220,133,99,167];
				for(const grid of black) {
					rule += `ç¬¬${grid}æ ¼æ˜¯é»‘æ ¼\n`;
				}
				rule += 'æ¯ä¸€æ ¼ç©ºç™½çš„æ ¼å­å¯ä»¥å½¢æˆ1æ¡å›è·¯\n';
				$("#rules").val(rule);
				n = 17;
				m = 17;
				$("#sudoku-row").html(n);
				$("#sudoku-col").html(m);
				generate(n, m);
			} else if (modeStr === 'hashi') {
				n = 9;
				m = 9;
				$("#sudoku-row").html(n);
				$("#sudoku-col").html(m);
				generate(n, m);
				$("#rules").val("ç¬¬1æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º3,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬3æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º3,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬73æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º4,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬30æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º4,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬57æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º1,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬49æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º4,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬51æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º2,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬81æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º4,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬36æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º4,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬6æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º1,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nç¬¬76æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º6,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]\nçº¿æ®µä¹‹é—´äº’ä¸ç›¸äº¤\n");
				$('#replaceStr').val("ç¬¬<æ ¼å­åºå·>æ ¼è¿å‡ºçš„çº¿æ®µæ€»æ•°ä¸º<æ ¼å­å†…å®¹>,ä¸Šä¸‹å·¦å³çº¿æ®µæ•°é‡ä¸è¶…è¿‡[2,2,2,2]");
			}
		}

		$('#dropHelper').click(() => {
			const rules = $('#rules').val().split('\n');
			const blackGrid = new Set();
			for(const rule of rules) {
				if(/^ç¬¬\d+æ ¼.*æ˜¯é»‘æ ¼$/.test(rule)) {
					blackGrid.add(parseInt(rule.match(/\d+/)[0]));
				}
			}
			let str = "";
			let append = "";
			for(let i = 1; i <= n*m+1; i++) {
				if(blackGrid.has(i) || i == n*m+1) {
					if(str == "")continue;
					append += `ç¬¬[${str}]æ ¼æŒ‰é¡ºåºç»„æˆå•è¯\n`;
					str = "";
				} else {
					if(str == "") str = i.toString();
					else
					str += ',' + i.toString();
				}
			}
			$('#rules').val($('#rules').val() + "\n" + append);
		})

		$('#solveSudoku').click(async () => {
			function sleep(ms) {
				return new Promise(resolve => setTimeout(resolve, ms));
			}
			n = parseInt($("#sudoku-row").html());
			m = parseInt($("#sudoku-col").html());
			const solver = new Solver.SudokuSolver();
			await solver.solve(($('#rules').val().split('\n')), n, m, async ()=>{
				console.info("wtf");
				await sleep(2);
			});
		});

		let sudokuColumnArea = [];
		let sudokuRowArea = [];

		const sudokuChangeInput = (e) => {
			const value = parseInt(e.target.innerText);
			const data = e.target.dataset;
			const index = parseInt(data.idx);
			const column = parseInt(data.col);
			const row = parseInt(data.row);
			const line = data.type === "row" ? $("#sudoku-left #row-"+row).children() : $("#sudoku-upper #col-"+column).children();
			if(data && value !== "") {
				if(data.type === "col" && (index+1 === line.length)) {
					$(`#sudoku-upper #col-${data.col}`).prepend(`<div id="col-cell-${data.col}-${index+1}" data-type="col" data-col=${data.col} data-idx=${index+1} contenteditable="true" oninput="sudokuChangeInput(event)" class="col-input">0</div>`);
				}
				else if(data.type === "row" && (index+1 === line.length)) {
					$(`#sudoku-left #row-${data.row}`).prepend(`<div id="row-cell-${data.row}-${index+1}" data-type="row" data-row=${data.row} data-idx=${index+1} contenteditable="true" oninput="sudokuChangeInput(event)" class="row-input">0</div>`);
				}

			} else {
				if(data.type === "row") {
					while(sudokuRowArea[row].length > index) {
						$(`#sudoku-upper #row-${data.row}`).children().eq(0).remove();
					}
				} else {
					while(sudokuColumnArea[column].length > index) {
						$(`#sudoku-upper #col-${data.col}`).children().eq(0).remove();
					}
				}
			}
			var rule;
			if(data.type === "row") {
				let values = "";
				for(var i = 0; i < line.length; i++) {
					const cell = line[i];
					const cellData = cell.dataset;
					const cellValue = cell.innerText;
					if(cellValue === "0")continue;
					if(values === "") {
						values = cellValue;
					} else {
						values += "," + cellValue;
					}
				}
				rule = $("#leftReplaceStr").val().replace("<è¡Œå·>", row+1);
				updateRule(rule, values, "<è¡Œåºåˆ—å†…å®¹>");
			} else {
				let values = "";
				for(var i = 0; i < line.length; i++) {
					const cell = line[i];
					const cellData = cell.dataset;
					const cellValue = cell.innerText;
					if(cellValue === "0")continue;
					if(values === "") {
						values = cellValue;
					} else {
						values += "," + cellValue;
					}
				}
				rule = $("#upReplaceStr").val().replace("<åˆ—å·>", column+1);
				updateRule(rule, values, "<åˆ—åºåˆ—å†…å®¹>");
			}
		}

		const showUpper = () => {
			sudokuColumnArea = [];
			for(let i = 0; i < m; i++) {
				sudokuColumnArea.push([]);
			}
			$("#sudoku-upper").html('')
			for(var i = 0; i < m; i++) {
				$("#sudoku-upper").append(`<div id="col-${i}" class="col-container"></div>`);
				$(`#sudoku-upper #col-${i}`).append(`<div id="col-cell-${i}-0" data-type="col" data-col=${i} data-idx=0 contenteditable="true" oninput="sudokuChangeInput(event)" class="col-input">0</div>`);
			}
			$('#upperRules').css("display", "unset");
		}
		$('#show-upper').change(async () => {
			const checked = $('#show-upper').get(0).checked;
			if(checked) {
				showUpper();
			} else {
				$("#sudoku-upper").html('');
				$('#upperRules').css("display", "none");
			}
		});

		const showLeft = () => {
			sudokuRowArea = [];
			for(let i = 0; i < m; i++) {
				sudokuRowArea.push([]);
			}

			$("#sudoku-left").html('')
			for(var i = 0; i < n; i++) {
				$("#sudoku-left").append(`<div id="row-${i}" class="row-container"></div>`);
				$(`#sudoku-left #row-${i}`).append(`<div id="row-cell-${i}-0" data-type="row" data-row=${i} data-idx=0 contenteditable="true" oninput="sudokuChangeInput(event)" class="row-input">0</div>`);
			}
			$('#leftRules').css("display", "unset");
		}

		$('#show-left').change(async () => {
			const checked = $('#show-left').get(0).checked;
			if(checked) {
				showLeft();
			} else {
				$("#sudoku-left").html('');
				$('#leftRules').css("display", "none");
			}
		});

		initSudoku();

		$('#sudoku-col,#sudoku-row').on('change', (e) =>{
			n = parseInt($("#sudoku-row").html());
			m = parseInt($("#sudoku-col").html());
			if($('#show-left').get(0).checked) {
				showLeft();
			}
			if($('#show-upper').get(0).checked) {
				showUpper();
			}
			generate(n,m);
		});

// smart analysis
let analysisIndex = 0;
const morseAnalysis = (result, words, chars) => {
	result.append(`<h4 class="analysis-hint">å°è¯•è«æ–¯</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	let pt = "";
	const morse = useMethod(6).split('\n');
	for(const word of words) {
		const c = decodeProcess(morse[1], morse[0], word.replaceAll(chars[0], '.').replaceAll(chars[1], '-')).trim();
		if(c.length > 1) {
			pt += '*';
			continue;
		}
		pt += c;
	}
	$(`#analysis-bar-${analysisIndex-1}`).append(`<div><b>${chars[0]}ä¸ºç‚¹, ${chars[1]}ä¸ºé•¿:</b> ${pt}</div>`);

	pt = "";
	for(const word of words) {
		const c = decodeProcess(morse[1], morse[0], word.replaceAll(chars[1], '.').replaceAll(chars[0], '-')).trim();
		if(c.length > 1) {
			pt += '*';
			continue;
		}
		pt += c;
	}
	$(`#analysis-bar-${analysisIndex-1}`).append(`<div><b>${chars[1]}ä¸ºç‚¹, ${chars[0]}ä¸ºé•¿:</b> ${pt}</div>`);
}


let folderStatus = false;

const systemAnalysis = (result, nums, row) => {
	const alphabet = substitutionTable[1].split(" ");
	result.append(`<button id="systemCheck">å°è¯•2-36è¿›åˆ¶è½¬10è¿›åˆ¶ +</button>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar folder" style="${folderStatus?"":"display: none"};"></div>`);
	$(`#systemCheck`).click(()=>{
		console.info("a");
		if(folderStatus){
			$(".folder")[0].style.display = "none";
		}else{
			$(".folder")[0].style.display = "block";
		}
		folderStatus = !folderStatus;
	});
	console.info("b");

	let u = 2;
	for(let i = 25, j = 36; i >= 0; i--, j--) {
		if(row.includes(alphabet[i])) {
			u = j;
			break;
		}
	}
	if(u==2)for(let i = 9; i >= 2; i--) {
		if(row.includes(i)) {
			u = i+1;
			break;
		}
	}
	const numResult = $(`#analysis-bar-${analysisIndex-1}`);
	const special = [2,3,8,16];
	for(let i = u; i <= 36; i++) {
		const numi = nums.map((x)=>parseInt(x, i));
		numResult.append(`<div><b ${special.includes(i)?'style="color: red;"': ""}>${i}è¿›åˆ¶:</b> ${numi.join(" ")}</div>`);
	}
};

const _roman = { M: 1000, CM: 900, D: 500, CD: 400, C: 100, XC: 90, L: 50, XL: 40, X: 10, IX: 9, V: 5, IV: 4, I: 1 };

const romanize = (number) => {
    return Object.keys(_roman).reduce((acc, key) => {
        while (number >= _roman[key]) {
            acc += key;
            number -= _roman[key];
        }
        return acc;
    }, '');
}



const deromanize = (roman) => {
  const romanNumeralRegex = new RegExp(
    /^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/
  );
  roman = roman.toUpperCase();
  const regexResult = romanNumeralRegex.test(roman);

  if (!regexResult) {
    return false;
  }

  let arr = ["I", "V", "X", "L", "C", "D", "M"];

  let values = {
    I: 1,
    V: 5,
    X: 10,
    L: 50,
    C: 100,
    D: 500,
    M: 1000,
  };

  let sum = 0;

  let prevIndex = 0;

  for (let i = roman.length - 1; i >= 0; i--) {
    if (arr.indexOf(roman[i]) >= prevIndex) {
      sum = sum + values[roman[i]];
    } else {
      sum = sum - values[roman[i]];
    }
    prevIndex = arr.indexOf(roman[i]);
  }

  return sum;
};


const numbersAnalysis = (result, nums, rows) => {
	result.append(`<h4 class="analysis-hint">å°è¯•æ•°å­—</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	const numResult = $(`#analysis-bar-${analysisIndex-1}`);
	if(nums.filter((x)=>
		x <=0 || x > 26
	).length === 0) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—éƒ½åœ¨1-26ä¹‹é—´</h4>`);
		const answer = nums.map((x)=>String.fromCharCode(x+96)).join("");
		numResult.append(`<div><b>A=1..Z=26:</b> ${answer}</div>`);
	}
	if(nums.filter((x)=>
		x <0 || x >= 26
	).length === 0) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—éƒ½åœ¨0-25ä¹‹é—´</h4>`);
		const answer = nums.map((x)=>String.fromCharCode(x+97)).join("");
		numResult.append(`<div><b>A=0..Z=25:</b> ${answer}</div>`);
	}
	if(nums.filter((x)=>
		x <=0 || x >= 255
	).length === 0) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—éƒ½åœ¨1-255ä¹‹é—´,å°è¯•ASCIIç </h4>`);
		const answer = nums.map((x)=>String.fromCharCode(x)).join("");
		numResult.append(`<div><b>ASCII:</b> ${answer}</div>`);
	} else if(nums.filter((x)=>
		x <=0 || x > 65536
	).length === 0) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—éƒ½åœ¨1-65536ä¹‹é—´,å°è¯•UNICODEç </h4>`);
		const answer = nums.map((x)=>String.fromCharCode(x)).join("");
		numResult.append(`<div><b>UNICODE:</b> ${answer}</div>`);
	}

	if(nums.filter((x)=>x >= 118 || x <= 0).length === 0) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—éƒ½åœ¨1-118ä¹‹é—´,å°è¯•å…ƒç´ å‘¨æœŸè¡¨</h4>`);
		const element = useMethod(7).split('\n');
		let pt = "";
		for(const word of rows) {
			let c = decodeProcess(element[0], element[1], word).trim();
			c = c[0].toUpperCase() + c.slice(1);
			pt += c + " ";
		}
		numResult.append(`<div><b>å…ƒç´ ç¬¦å·:</b> ${pt}</div>`);
	}


	let romanFlag = true;
	let pt = "";
	for(const num of nums) {
		if(num > 3999 || num < 0) {
			romanFlag = false;
			break;
		}
		const rnum = romanize(num);
		if(!rnum) {
			romanFlag = false;
			break;
		}
		pt += rnum + " ";
	}
	if(romanFlag) {
		numResult.append(`<div><b>ç½—é©¬æ•°å­—:</b> ${pt}</div>`);
	}

	const five = rows.filter((x)=>(x.length == 2) && (parseInt(x[0]) <= 5 && parseInt(x[0]) >= 1) && (parseInt(x[1]) <= 5 && parseInt(x[1]) >= 1));
	if(five.length === rows.length) {
		numResult.append(`<h4 class="analysis-hint">å‘ç°æ‰€æœ‰æ•°å­—é•¿åº¦éƒ½ä¸º2,ä¸”éƒ½åœ¨1åˆ°5ä¹‹é—´ï¼Œå°è¯•æ£‹ç›˜å¯†ç </h4>`);
		const fives = useMethod(4).split('\n');
		let pt = "";
		for(const word of rows) {
			const c = decodeProcess(fives[1], fives[0], word).trim();
			pt += c;
		}
		$(`#analysis-bar-${analysisIndex-1}`).append(`<div><b>5*5æ£‹ç›˜</b> ${pt}</div>`);
	}
}

const summaryAnalysis = (result, str) => {
	result.append(`<h4 class="analysis-hint">ç»¼åˆåˆ†æ</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	const summaryResult = $(`#analysis-bar-${analysisIndex-1}`);
	const len = str.length;
	summaryResult.append(`<div>å…±${len}ä¸ªå­—ç¬¦, è¯¦ç»†ç»Ÿè®¡</div>`);
	const chars = {};
	for(let i = 0; i < len; i++) {
		chars[str[i]] = (chars[str[i]] || 0) + 1;
	}
	const res = Object.entries(chars);
	let s = "";
	for(const entry of res) {
		summaryResult.append(`<div>${entry[0]}: ${entry[1]}</div>`);
	}

	for(let i = 2; i * i <= len; i++) {
		if(len % i == 0) {
			summaryResult.append(`<h4 class="analysis-hint">å°è¯•å°†æ–‡æœ¬é‡æ–°æ’åˆ—æˆ${i} * ${len/i}çš„çŸ©é˜µ:</h4>`);
			let mat = "";
			for(let j = 0; j <= len; j+=i) {
				mat += str.substring(j, j+i) + "\n";
			}
			summaryResult.append(`<pre>${mat.slice(0, -1)}</pre>`);
			if(i*i != len) {
				summaryResult.append(`<h4 class="analysis-hint">å°è¯•å°†æ–‡æœ¬é‡æ–°æ’åˆ—æˆ${len/i} * ${i}çš„çŸ©é˜µ:</h4>`);
				mat = "";
				for(let j = 0; j <= len; j+=len/i) {
					mat += str.substring(j, j+len/i) + "\n";
				}
				summaryResult.append(`<pre>${mat.slice(0, -1)}</pre>`);
			}
		}
	}
}

const binaryAnalysis = (result, words, chars) => {
	let pt = "";
	result.append(`<h4 class="analysis-hint">å°è¯•äºŒè¿›åˆ¶</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	const binaryResult = $(`#analysis-bar-${analysisIndex-1}`);
	let numbers = [];
	for(const word of words) {
		const number = parseInt(word.replaceAll(chars[0], ' ').replaceAll(chars[1], '0').replaceAll(' ', '1'), 2);
		numbers.push(number);
		pt += number.toString() + " ";
	}

	binaryResult.append(`<div><b>è‹¥${chars[0]}ä¸º1, ${chars[1]}ä¸º0:</b> ${pt}</div>`);

	binaryResult.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);

	numbersAnalysis($(`#analysis-bar-${analysisIndex-1}`), numbers, numbers.map((x)=>x.toString()));

	pt = "";
	numbers = [];
	for(const word of words) {
		const number = parseInt(word.replaceAll(chars[1], ' ').replaceAll(chars[0], '0').replaceAll(' ', '1'), 2);
		numbers.push(number);
		pt += number.toString() + " ";
	}


	binaryResult.append(`<div><b>è‹¥${chars[1]}ä¸º1, ${chars[0]}ä¸º0:</b> ${pt}</div>`);
	binaryResult.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	numbersAnalysis($(`#analysis-bar-${analysisIndex-1}`), numbers, numbers.map((x)=>x.toString()));
}

const elementsAnalysis = (result, words) => {
	result.append(`<h4 class="analysis-hint">å…ƒç´ åºå·</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	const elementsResult = $(`#analysis-bar-${analysisIndex-1}`);
	let numbers = [];
	let pt = "";
	const element = useMethod(7).split('\n');
	for(const word of words) {
		const c = decodeProcess(element[1], element[0], word).trim();
		pt += c + " ";
		numbers.push(c);
	}
	elementsResult.append(`<div><b>å…ƒç´ åºå·:</b> ${pt}</div>`);
	numbersAnalysis(elementsResult, numbers.map(x=>parseInt(x)), numbers);
}

const lettersAnalysis = (result, content, words) => {
	let element = useMethod(0).split('\n');
	result.append(`<div><b>å­—æ¯åº(a = 1, z = 26): </b>${decodeProcess(element[0], element[1], content)}</div>`);
	element = useMethod(2).split('\n');
	result.append(`<div><b>QWEç¼–ç (a = q): </b>${words.map((x) => decodeProcess(element[0], element[1], x).replaceAll(" ", "")).join(" ")}</div>`);
	element = useMethod(2).split('\n');
	result.append(`<div><b>QWEè§£ç (q = a): </b>${words.map((x) => decodeProcess(element[1], element[0], x).replaceAll(" ", "")).join(" ")}</div>`);
	element = useMethod(3).split('\n');
	result.append(`<div><b>Atbash: </b>${words.map((x) => decodeProcess(element[0], element[1], x).replaceAll(" ", "")).join(" ")}</div>`);
	element = useMethod(6).split('\n');
	result.append(`<div><b>è«æ–¯ç¼–ç : </b>${words.map((x) => decodeProcess(element[0], element[1], x)).join(" ")}</div>`);
	element = useMethod(8).split('\n');
	result.append(`<div><b>ç›²æ–‡: </b>${words.map((x) => decodeProcess(element[0], element[1], x).replaceAll(" ", "")).join(" ")}</div>`);
	result.append(`<h4 class="analysis-hint">å‡¯æ’’ç§»ä½(æš´åŠ›)</h4>`);
	result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
	const caeserResult = $(`#analysis-bar-${analysisIndex-1}`);
	for(let i = 1; i < 26; i++) {
		caeserResult.append(`<div><b>ç§»åŠ¨${i}ä½: </b> ${caeser(content, i)}</div>`);
	}
	//result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
}

const chineseAnalysis = (result, row) => {
	const chineseToUnicodeHex = (chinese) => {
		let unicode = '';
		for (let i = 0; i < chinese.length; i++) {
			const hex = chinese.charCodeAt(i).toString(16);
			unicode += '\\u' + ('0000' + hex).slice(-4) + ' ';
		}
		return unicode;
	}
	const chineseToUnicode = (chinese) => {
		let unicode = '';
		for (let i = 0; i < chinese.length; i++) {
			const hex = chinese.charCodeAt(i).toString();
			unicode += hex + ' ';
		}
		return unicode;
	}
	result.append(`<div><b>è½¬UNICODE(åå…­è¿›åˆ¶): </b>${chineseToUnicodeHex(row)}</div>`);
	result.append(`<div><b>è½¬UNICODE(åè¿›åˆ¶): </b>${chineseToUnicode(row)}</div>`);
}

const hexAnalysis = (result, nums) => {
	result.append(`<div><b>UNICODEè½¬å­—ç¬¦(åå…­è¿›åˆ¶): </b>${nums.map((x) => String.fromCharCode(x)).reduce((x, y) => x + y)}</div>`);

}

$("#smart-analysis-content").on("keyup paste", () => {
	analysisIndex = 0;
	const result = $("#smart-analysis-ansers-list");
	result.html("");
	const content = $("#smart-analysis-content").val();
	const row = content.trim().toLowerCase();
	const words = row.split(/[\s,]+/);
	const count = {};
	const chars = [];
	let index = 0;
	let countOfChar = 0;
	let isAllnumber = true;
	const cheElement = substitutionTable[9].split(' ');
	let isAllElement = true;
	let isAllLetter = true;
	let hasChinese = false;
	for(const word of words) {
		for(let i = 0; i < word.length; i++) {
			if(count[word[i]] === undefined) {
				count[word[i]] = 1;
				chars.push(word[i]);
				countOfChar++;
			} else {
				count[word[i]]++;
			}
		}
		if(isAllnumber && !/^-?\d+$/.test(word)) {
			isAllnumber = false;
		}
		if(isAllElement && !cheElement.includes(word)) {
			isAllElement = false;
		}

		if(isAllLetter && ((/^[a-zA-Z]*$/.test(word)) === false)) {
			isAllLetter = false;
		}

		if(word.charCodeAt(0) > 256) {
			hasChinese = true;
		}
	}

	let hexs = [];
	for(const word of words) {
		let h = word;
		if(h.startsWith("\\u") || h.startsWith("0x")) {
			h = h.slice(2);
		}
		if(h.startsWith("&#x")) {
			h = h.slice(3);
		}

		if(!/^[0-9a-fA-F]+$/.test(h)) {
			hexs = [];
			break;
		}
		hexs.push(parseInt(h, 16));
	}
	if(countOfChar <= 2) {
		result.append(`<div class="analysis-hint">åªæœ‰ä¸¤ä¸ªå­—ç¬¦, å¼€å§‹äºŒå€¼åˆ†æ</div><div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div`);
		const index = analysisIndex-1;
		morseAnalysis($(`#analysis-bar-${index}`), words, chars);
		binaryAnalysis($(`#analysis-bar-${index}`), words, chars);

	}

	if(isAllnumber) {
		numbersAnalysis(result, words.map((x) => parseInt(x)), words);
	}

	if(isAllElement) {
		result.append(`<div class="analysis-hint">å…¨éƒ¨ä¸ºå…ƒç´ ç¬¦å·, å¼€å§‹å…ƒç´ ç¬¦å·åˆ†æ</div>`);
		result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
		const index = analysisIndex-1;
		elementsAnalysis($(`#analysis-bar-${index}`), words);
	}

	if(isAllLetter) {
		let pt = "";
		let romanFlag = true;
		const numbers = [];
		for(const word of words) {
			const number = deromanize(word);
			if(!number) {
				romanFlag = false;
				break;
			}
			numbers.push(number);
			pt += number.toString() + " ";
		}

		if(romanFlag) {
			result.append(`<div class="analysis-hint">å…¨éƒ¨ä¸ºç½—é©¬æ•°å­—</div>`);
			result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
			const index = analysisIndex-1;
			const romanResult = $(`#analysis-bar-${index}`);
			romanResult.append(`<div><b>ç½—é©¬æ•°å­—:</b>${pt}</div>`);
			numbersAnalysis(romanResult, numbers, numbers.map(x=>x.toString()));
		}

		result.append(`<div class="analysis-hint">å…¨éƒ¨ä¸ºå­—æ¯, å¼€å§‹åŠ å¯†åˆ†æ</div>`);
		result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
		const index = analysisIndex-1;
		lettersAnalysis($(`#analysis-bar-${index}`), row, words);
	}

	if(hasChinese) {
		result.append(`<div class="analysis-hint">å­˜åœ¨éASCIIå­—ç¬¦</div>`);
		result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
		const index = analysisIndex-1;
		chineseAnalysis($(`#analysis-bar-${index}`), row);
	}

	if(hexs.length != 0) {
		result.append(`<div class="analysis-hint">å°è¯•åå…­è¿›åˆ¶</div>`);
		result.append(`<div id="analysis-bar-${analysisIndex++}" class="analysis-bar"></div>`);
		const index = analysisIndex-1;
		hexAnalysis($(`#analysis-bar-${index}`), hexs);
	}

	result.append(`<div><b>å€’åº:</b>${Array.from(content).reverse().join('')}</div>`);



	systemAnalysis(result, words, row)

	summaryAnalysis(result, content);

});

// cvs
	const canvas = document.getElementById('cvs');
	const ctx = canvas.getContext('2d');
	let imageData;

	ctx.font = '20px Arial';
	ctx.fillStyle = 'gray';
	ctx.textAlign = 'center';
	ctx.fillText('å¤åˆ¶å›¾ç‰‡åï¼Œctrl+V è½½å…¥å›¾ç‰‡', canvas.width / 2, canvas.height / 2);
	document.addEventListener('paste', function (e) { cvsPaste(e); }, false);

	const cvsPaste = (e) => {
		paste_createImage = function (source) {
			var pastedImage = new Image();
			pastedImage.onload = function () {
				canvas.width = pastedImage.width;
				canvas.height = pastedImage.height;
				ctx.drawImage(pastedImage, 0, 0);
				imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

				document.getElementById('cvs-r').width = document.getElementById('cvs-g').width = document.getElementById('cvs-b').width = canvas.width;
				document.getElementById('cvs-r').height = document.getElementById('cvs-g').height = document.getElementById('cvs-b').height = canvas.height;
				const redCtx = document.getElementById('cvs-r').getContext('2d');
				const greenCtx = document.getElementById('cvs-g').getContext('2d');
				const blueCtx = document.getElementById('cvs-b').getContext('2d');
				const redImageData = redCtx.createImageData(canvas.width, canvas.height);
				const greenImageData = greenCtx.createImageData(canvas.width, canvas.height);
				const blueImageData = blueCtx.createImageData(canvas.width, canvas.height);

				for (let i = 0; i < imageData.data.length; i += 4) {
					redImageData.data[i] = imageData.data[i];
					greenImageData.data[i+1] = imageData.data[i+1];
					blueImageData.data[i+2] = imageData.data[i+2];
					redImageData.data[i+3] = greenImageData.data[i+3] = blueImageData.data[i+3] = 255;
				}
				redCtx.putImageData(redImageData, 0, 0);
				greenCtx.putImageData(greenImageData, 0, 0);
				blueCtx.putImageData(blueImageData, 0, 0);
				$('#cvs-rgb').css("display", "unset");
			};
			pastedImage.src = source;
		};
		if (e.clipboardData) {
			var items = e.clipboardData.items;
			if (!items) return;
			
			var is_image = false;
			for (var i = 0; i < items.length; i++) {
				if (items[i].type.indexOf("image") !== -1) {
					var blob = items[i].getAsFile();
					var URLObj = window.URL || window.webkitURL;
					var source = URLObj.createObjectURL(blob);
					paste_createImage(source);
					is_image = true;
				}
			}
			if(is_image == true){
				e.preventDefault();
			}
		}
	};

	canvas.addEventListener('mousemove', function(event) {
		const x = event.pageX - canvas.offsetLeft;
		const y = event.pageY - canvas.offsetTop;
		$('#cvs-details').html(`<div>x: ${x}, y: ${y}</div><div>RGB(çº¢ç»¿è“): (${imageData.data[(y * canvas.width + x) * 4]}, ${imageData.data[(y * canvas.width + x) * 4 + 1]}, ${imageData.data[(y * canvas.width + x) * 4 + 2]})</div>`);

	});

	var ppPoint = function(x, y)
        {
            this.x = x;
            this.y = y;
        }
        let blockMousePressed = false;
        let ppPointArray = new Array();
		let drawMode = '';
        $('#cvs').mousedown(function(e)
        {
            if(e.which == 1 && drawMode == 'pen')// å¦‚æœæ˜¯å·¦é”®
            {
                blockMousePressed = true;
                var mouseX = e.pageX - this.offsetLeft;
                var mouseY = e.pageY - this.offsetTop;
                ppPointArray.push(new ppPoint(mouseX, mouseY));

                $(e.target).mousemove(function(eve)
                {
                    if(blockMousePressed)
                    {
                        var mouseX = eve.pageX - this.offsetLeft;
                        var mouseY = eve.pageY - this.offsetTop;
                        ppDrawLine(mouseX, mouseY, eve.currentTarget.getContext("2d"));
                    }
                });

                $(window).mouseup(function(e){
                    blockMousePressed = false;
                    rubicCubeStage.draw();
                    $(e.target).off("mousemove");
                });
            }
        });

        $('#cvs').on("touchstart",function(e)
        {
			if(drawMode == 'pen') {
				var mouseX = e.originalEvent.changedTouches[0].pageX - this.offsetLeft;
				var mouseY = e.originalEvent.changedTouches[0].pageY - this.offsetTop;
				blockMousePressed = true;
				ppPointArray.push(new ppPoint(mouseX, mouseY));
				e.preventDefault();
				$(e.target).on("touchmove",function(eve)
				{
					if(blockMousePressed)
					{
						var mouseX = eve.originalEvent.changedTouches[0].pageX- this.offsetLeft;
						var mouseY = eve.originalEvent.changedTouches[0].pageY - this.offsetTop;
						ppDrawLine(mouseX, mouseY, eve.currentTarget.getContext("2d"));
					}
				});

				$(window).mouseup(function(e){
					blockMousePressed = false;
					rubicCubeStage.draw();
					$(e.target).off("touchmove");
				});
			}

        });

        
        
        function ppDrawLine(curX, curY, context)
        {
            const color = 'red';
            context.strokeStyle = color;
            const width = 5;
            context.lineWidth = parseInt(width);
            context.beginPath();
            var ppLastPoint = ppPointArray[ppPointArray.length - 1];
            context.moveTo(ppLastPoint.x, ppLastPoint.y);
            context.lineTo(curX, curY);
            context.closePath();
            context.stroke();
            ppPointArray.push(new ppPoint(curX, curY));
        }

		$('#cvs-tools span').click((e) => {
			console.info(e.target.id);
			drawMode = e.target.id;
		})

		</script>
		<script src="./static/dict.v1.0.min.js"></script>
		<script>
			if(!localStorage.abc) {
				for(const obj in words) {localStorage.setItem(obj, words[obj]);}
				solver = new Solver.OneWord();
				$('h3').remove();
			}
		</script>
		<script src="./out.js"></script>
		</div>
	</body>
</html>
